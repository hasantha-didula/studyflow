<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyFlow Pro · Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .input-focus-ring:focus {
            outline: none;
            ring: 2px solid #4f46e5;
            border-color: #4f46e5;
        }
        .floating-label {
            transition: all 0.2s ease;
        }
        .auth-divider {
            display: flex;
            align-items: center;
            text-align: center;
            color: #94a3b8;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #e2e8f0;
        }
        .auth-divider::before {
            margin-right: 1rem;
        }
        .auth-divider::after {
            margin-left: 1rem;
        }
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    
    <!-- Background decoration -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 animate-pulse" style="animation-delay: 2s;"></div>
    </div>

    <!-- Login Card -->
    <div class="w-full max-w-md animate-slide-up relative z-10">
        <!-- Logo & Brand -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center gap-3 bg-white/10 backdrop-blur-lg px-6 py-3 rounded-2xl shadow-2xl">
                <div class="w-12 h-12 bg-indigo-600 rounded-xl flex items-center justify-center shadow-indigo-200 shadow-xl">
                    <i data-lucide="zap" class="text-white w-7 h-7"></i>
                </div>
                <span class="font-extrabold text-3xl tracking-tight italic text-white drop-shadow-lg">StudyFlow<span class="text-indigo-200">.</span></span>
            </div>
            <p class="text-white/80 text-sm font-medium mt-4">Academic intelligence · Seamless workflow</p>
        </div>

        <!-- Login Form Container -->
        <div class="glass-card rounded-[2rem] shadow-2xl p-8 md:p-10">
            <!-- Tab Switcher -->
            <div class="flex bg-slate-100 rounded-2xl p-1 mb-8">
                <button id="login-tab-btn" onclick="switchAuthTab('login')" class="flex-1 py-3 px-4 rounded-xl font-black text-sm transition-all auth-tab active">
                    <i data-lucide="log-in" class="w-4 h-4 inline mr-2"></i>Sign In
                </button>
                <button id="signup-tab-btn" onclick="switchAuthTab('signup')" class="flex-1 py-3 px-4 rounded-xl font-black text-sm transition-all auth-tab">
                    <i data-lucide="user-plus" class="w-4 h-4 inline mr-2"></i>Create Account
                </button>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form space-y-5">
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Email</label>
                    <div class="relative">
                        <i data-lucide="mail" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="email" id="login-email" placeholder="you@university.edu" 
                               class="w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none font-medium focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Password</label>
                    <div class="relative">
                        <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="password" id="login-password" placeholder="••••••••" 
                               class="w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none font-medium focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all">
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" class="w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                        <span class="text-xs font-medium text-slate-600">Remember me</span>
                    </label>
                    <button onclick="forgotPassword()" class="text-xs font-bold text-indigo-600 hover:text-indigo-800 transition-colors">Forgot password?</button>
                </div>
                <button onclick="handleLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-4 rounded-2xl font-black text-sm shadow-lg shadow-indigo-200 transition-all transform hover:scale-[1.02]">
                    <i data-lucide="log-in" class="w-4 h-4 inline mr-2"></i>Access Dashboard
                </button>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form hidden space-y-5">
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Full Name</label>
                    <div class="relative">
                        <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="text" id="signup-name" placeholder="Alex Chen" 
                               class="w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none font-medium focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Email</label>
                    <div class="relative">
                        <i data-lucide="mail" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="email" id="signup-email" placeholder="you@university.edu" 
                               class="w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none font-medium focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Password</label>
                    <div class="relative">
                        <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="password" id="signup-password" placeholder="Create a strong password" 
                               class="w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none font-medium focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all">
                    </div>
                    <p class="text-[10px] text-slate-500 mt-2 font-medium">At least 8 characters</p>
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase text-slate-400 mb-1 block">Confirm Password</label>
                    <div class="relative">
                        <i data-lucide="lock" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                        <input type="password" id="signup-confirm" placeholder="Re-enter password" 
                               class="w-full pl-12 pr-5 py-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none font-medium focus:border-indigo-600 focus:ring-2 focus:ring-indigo-200 transition-all">
                    </div>
                </div>
                <div class="flex items-start gap-2">
                    <input type="checkbox" id="terms" class="mt-1 w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500">
                    <label for="terms" class="text-xs text-slate-600 font-medium">
                        I agree to the <a href="#" class="text-indigo-600 font-bold hover:underline">Terms of Service</a> and <a href="#" class="text-indigo-600 font-bold hover:underline">Privacy Policy</a>
                    </label>
                </div>
                <button onclick="handleSignup()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white py-4 rounded-2xl font-black text-sm shadow-lg shadow-emerald-200 transition-all transform hover:scale-[1.02]">
                    <i data-lucide="user-plus" class="w-4 h-4 inline mr-2"></i>Create Account
                </button>
            </div>

            <!-- Divider -->
            <div class="auth-divider my-6">
                <span class="px-4">or continue with</span>
            </div>

            <!-- Social Login -->
            <div class="grid grid-cols-2 gap-4">
                <button onclick="handleGoogleLogin()" class="flex items-center justify-center gap-2 py-3 px-4 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-all font-bold text-sm text-slate-700">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" class="w-5 h-5">
                    Google
                </button>
                <button onclick="handleGithubLogin()" class="flex items-center justify-center gap-2 py-3 px-4 bg-slate-900 border border-slate-900 rounded-xl hover:bg-slate-800 transition-all font-bold text-sm text-white">
                    <i data-lucide="github" class="w-5 h-5"></i>
                    GitHub
                </button>
            </div>

            <!-- Anonymous Access -->
            <div class="mt-6 text-center">
                <button onclick="handleAnonymousLogin()" class="text-xs font-bold text-slate-500 hover:text-indigo-600 transition-colors">
                    <i data-lucide="user" class="w-3.5 h-3.5 inline mr-1"></i>
                    Continue as guest (no account)
                </button>
            </div>
        </div>

        <!-- Footer -->
        <p class="text-center text-white/70 text-[10px] font-black uppercase tracking-wider mt-8">
            © 2026 StudyFlow Pro · Academic Intelligence Suite
        </p>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 transform transition-all duration-500 translate-y-20 opacity-0">
        <i data-lucide="check-circle" class="w-5 h-5 text-emerald-400"></i>
        <span id="toast-message" class="text-sm font-bold">Message</span>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="hidden fixed inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-[2rem] shadow-2xl flex flex-col items-center gap-4">
            <div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
            <p class="font-black text-slate-800">Authenticating...</p>
        </div>
    </div>

    <script>
        // =============================================
        // SUPABASE CONFIGURATION - MATCH YOUR MAIN APP
        // =============================================
        const SUPABASE_URL = "https://lkxhfkvptlzbsccdouzd.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxreGhma3ZwdGx6YnNjY2RvdXpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5MTA1MjQsImV4cCI6MjA4NjQ4NjUyNH0.kiXW5U5cu0-JkK0ewx2hWLMeG9h5co1xH5_5Tn3VLBU";

        // Initialize Supabase client
        const supabase = window.supabase?.createClient 
            ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
            : null;

        // =============================================
        // UI HELPERS
        // =============================================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            const toastIcon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            
            if (type === 'success') {
                toastIcon.setAttribute('data-lucide', 'check-circle');
                toastIcon.classList.add('text-emerald-400');
            } else if (type === 'error') {
                toastIcon.setAttribute('data-lucide', 'alert-circle');
                toastIcon.classList.add('text-rose-400');
            } else if (type === 'info') {
                toastIcon.setAttribute('data-lucide', 'info');
                toastIcon.classList.add('text-blue-400');
            }
            
            lucide.createIcons();
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 4000);
        }

        function showLoading(show = true) {
            const overlay = document.getElementById('loading-overlay');
            if (show) {
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }

        // =============================================
        // AUTH UI SWITCHING
        // =============================================
        window.switchAuthTab = function(tab) {
            const loginBtn = document.getElementById('login-tab-btn');
            const signupBtn = document.getElementById('signup-tab-btn');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            
            if (tab === 'login') {
                loginBtn.classList.add('active', 'bg-white', 'shadow-sm', 'text-slate-900');
                signupBtn.classList.remove('active', 'bg-white', 'shadow-sm', 'text-slate-900');
                signupBtn.classList.add('text-slate-500');
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                signupBtn.classList.add('active', 'bg-white', 'shadow-sm', 'text-slate-900');
                loginBtn.classList.remove('active', 'bg-white', 'shadow-sm', 'text-slate-900');
                loginBtn.classList.add('text-slate-500');
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
            lucide.createIcons();
        };

        // =============================================
        // AUTH HANDLERS - SUPABASE INTEGRATION
        // =============================================
        window.handleLogin = async function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showToast('Please enter email and password', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                showToast('Login successful! Redirecting...', 'success');
                
                // Store session info
                localStorage.setItem('studyflow_user', JSON.stringify(data.user));
                
                // Redirect to main app
                setTimeout(() => {
                    window.location.href = 'index.html'; // Your main app file
                }, 1500);
                
            } catch (error) {
                console.error('Login error:', error);
                showToast(error.message || 'Invalid credentials', 'error');
            } finally {
                showLoading(false);
            }
        };

        window.handleSignup = async function() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirm = document.getElementById('signup-confirm').value;
            const terms = document.getElementById('terms').checked;
            
            if (!name || !email || !password || !confirm) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            if (!terms) {
                showToast('You must agree to the terms', 'error');
                return;
            }
            
            if (password !== confirm) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 8) {
                showToast('Password must be at least 8 characters', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: name
                        }
                    }
                });
                
                if (error) throw error;
                
                if (data.user && data.session) {
                    showToast('Account created! Redirecting...', 'success');
                    localStorage.setItem('studyflow_user', JSON.stringify(data.user));
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                } else {
                    showToast('Please check your email for confirmation', 'info');
                    // Auto switch to login tab
                    switchAuthTab('login');
                }
                
            } catch (error) {
                console.error('Signup error:', error);
                showToast(error.message || 'Signup failed', 'error');
            } finally {
                showLoading(false);
            }
        };

        window.handleAnonymousLogin = async function() {
            showLoading(true);
            
            try {
                const { data, error } = await supabase.auth.signInAnonymously();
                
                if (error) throw error;
                
                showToast('Continuing as guest', 'success');
                localStorage.setItem('studyflow_user', JSON.stringify(data.user));
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
                
            } catch (error) {
                console.error('Anonymous login error:', error);
                showToast('Demo mode: Continue without Supabase', 'info');
                
                // Fallback: still redirect for demo
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1500);
            } finally {
                showLoading(false);
            }
        };

        window.handleGoogleLogin = async function() {
            showLoading(true);
            
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin + '/index.html'
                    }
                });
                
                if (error) throw error;
                
            } catch (error) {
                console.error('Google login error:', error);
                showToast('Google login failed. Try another method.', 'error');
                showLoading(false);
            }
        };

        window.handleGithubLogin = async function() {
            showLoading(true);
            
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'github',
                    options: {
                        redirectTo: window.location.origin + '/index.html'
                    }
                });
                
                if (error) throw error;
                
            } catch (error) {
                console.error('GitHub login error:', error);
                showToast('GitHub login failed. Try another method.', 'error');
                showLoading(false);
            }
        };

        window.forgotPassword = async function() {
            const email = document.getElementById('login-email').value;
            
            if (!email) {
                showToast('Please enter your email address', 'error');
                return;
            }
            
            showLoading(true);
            
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin + '/reset-password.html',
                });
                
                if (error) throw error;
                
                showToast('Password reset email sent!', 'success');
                
            } catch (error) {
                console.error('Reset password error:', error);
                showToast(error.message || 'Failed to send reset email', 'error');
            } finally {
                showLoading(false);
            }
        };

        // =============================================
        // CHECK EXISTING SESSION
        // =============================================
        async function checkExistingSession() {
            if (!supabase) return;
            
            try {
                const { data: { session } } = await supabase.auth.getSession();
                
                if (session) {
                    // Auto-redirect if already logged in
                    window.location.href = 'index.html';
                }
            } catch (error) {
                console.error('Session check error:', error);
            }
        }

        // Initialize Lucide icons and check session
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            // Set default active tab styles
            document.getElementById('login-tab-btn').classList.add('active', 'bg-white', 'shadow-sm', 'text-slate-900');
            document.getElementById('signup-tab-btn').classList.add('text-slate-500');
            
            // Check if user is already logged in
            checkExistingSession();
        });
    </script>

    <!-- Include Supabase JS if not available -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
